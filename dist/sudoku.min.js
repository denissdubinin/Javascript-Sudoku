/*! Javascript Sudoku v1.0.0 by Deniss Dubinin - https://github.com/denissdubinin/Javascript-Sudoku - Licensed MIT */

"use strict";window.sudoku={Valve:"Trilogy"},function(window,$){$.fn.Sudoku=function(options){var defaults={squareSize:3,dropTimerOnReset:!0,markWrongCellsOnFly:!1,markWrongCellsOnFinish:!0,useTimer:!0,timerOnly:!0,useCustomButtons:!1,sudokuMixIterations:500},options=$.extend({},defaults,options),sudokuTimer;function create(o){o.addClass("sudoku"),generateGui(o),init()}function init(){toggleLoadingOverlay(!0),generateMatrix(),mixMatrix(),prepareEmptyMatrix(),fillGrid(),enableFields(!1)}function generateGui(o){options.useTimer&&o.prepend('<label id="sudoku-minutes">00</label>:<label id="sudoku-seconds">00</label>'),$('<table class="table table-bordered"></table>').appendTo(o);for(var t=0,e=0;t<options.squareSize**2;){for(var n=$('<tr class="sudoku-row"></tr>').appendTo(o.find("table"));e<options.squareSize**2;)$('<td class="sudoku-cell"><input size="1" maxlength="1" onkeypress="return window.sudoku.listenKeyPress(event);"></td>').appendTo(n),e++;e=0,t++}enableFields(!1),initGridButtons(o)}function validateSudoku(o){var t=$(".sudoku-cell").find("input").filter(function(){return""===this.value});if(options.markWrongCellsOnFly){var e=$(o).parent(),n=e.parent().index(),i=e.index();parseInt($(o).val())===window.sudoku.fullMatrix[n][i]||""===$(o).val()?e.removeClass("invalid-cell"):e.addClass("invalid-cell")}if(options.markWrongCellsOnFinish&&!t.length){var s=[];$(".sudoku .sudoku-row").each(function(o){s.push([]),$(this).find("input").each(function(){s[o].push(parseInt($(this).val()))})}),checkResults(s,window.sudoku.fullMatrix)&&$(document).trigger("startConfetti")}}function toggleLoadingOverlay(o){o?$(".sudoku").addClass("loading"):$(".sudoku").removeClass("loading")}function initGridButtons(o){if(!options.useCustomButtons){var t=$("<div>").addClass("btn-group"),e=$("<button>").addClass("btn btn-danger btn-sm").attr("id","r-sudoku").text("Reset sudoku"),n=$("<button>").addClass("btn btn-primary btn-sm").attr("id","gn-sudoku").text("Generate new sudoku");if(options.useTimer){var i=$("<button>").addClass("btn btn-success btn-sm").attr("id","start-sudoku").text("Start");t.append(i)}t.append(e).append(n),o.append(t)}$("body").on("click","#start-sudoku",function(){options.useTimer&&initTimer(),enableFields(!0),i.prop("disabled",!0)}),$("body").on("click","#r-sudoku",function(){1==confirm("Are you sure?")&&(fillGrid(),$(".sudoku-cell").removeClass("invalid-cell"),options.useTimer&&options.dropTimerOnReset&&resetTimer(!1))}),$("body").on("click","#gn-sudoku",function(){1==confirm("Are you sure?")&&($(document).trigger("stopConfetti"),$(".sudoku-cell input:disabled:not(.default-cell)").prop("disabled",!1),$(".sudoku-cell").removeClass("invalid-cell"),$(".sudoku-cell input.default-cell").removeClass("default-cell"),options.useTimer&&($("#start-sudoku:not(.default-cell)").prop("disabled",!1),resetTimer(!0)),init())})}function enableFields(o){options.timerOnly&&options.useTimer&&(o?$(".sudoku-cell input:not(.default-cell)").prop("disabled",!1):$(".sudoku-cell input:not(.default-cell)").prop("disabled",!0))}function initTimer(){var o=$("#sudoku-minutes"),t=$("#sudoku-seconds"),e=0;function n(o){var t=o+"";return t.length<2?"0"+t:t}sudokuTimer=setInterval(function(){++e,t.text(n(e%60)),o.text(n(parseInt(e/60)))},1e3)}function resetTimer(o){$("#sudoku-minutes, #sudoku-seconds").text("00"),clearInterval(sudokuTimer),o?$("#start-sudoku").prop("disabled",!1):initTimer()}function stopTimer(){clearInterval(sudokuTimer)}function generateMatrix(){var o=options.squareSize,t=[];for(let i=0;i<options.squareSize**2;i++){var e=[];for(let t=0;t<options.squareSize**2;t++){var n=(i*o+i/o+t)%(o*o)+1;e.push(parseInt(n))}t.push(e)}window.sudoku.fullMatrix=t}function fillGrid(){$(".sudoku-row").each(function(o){$(this).find("td").each(function(t){var e=window.sudoku.emptyMatrix[o][t],n=$(this).find("input");n.val(e),""!==e&&n.prop("disabled",!0).addClass("default-cell")})}),toggleLoadingOverlay(!1),$(".sudoku-cell input").off("input").on("input",function(o){validateSudoku(o.target)})}function transposeMatrix(){return window.sudoku.fullMatrix=window.sudoku.fullMatrix[0].map(function(o,t){return window.sudoku.fullMatrix.map(function(o){return o[t]})}),window.sudoku.fullMatrix}function swapTwoRows(){for(var o=Math.floor(Math.random()*options.squareSize),t=Math.floor(Math.random()*options.squareSize),e=Math.floor(Math.random()*options.squareSize),n=o*options.squareSize+t;t==e;)e=Math.floor(Math.random()*options.squareSize);var i=o*options.squareSize+e,s=window.sudoku.fullMatrix[n],u=window.sudoku.fullMatrix[i];return window.sudoku.fullMatrix[n]=u,window.sudoku.fullMatrix[i]=s,window.sudoku.fullMatrix}function swapTwoColumns(){transposeMatrix(),swapTwoRows(),transposeMatrix()}function swapTwoLargeRows(){for(var o=Math.floor(Math.random()*options.squareSize),t=Math.floor(Math.random()*options.squareSize);o==t;)t=Math.floor(Math.random()*options.squareSize);for(let u=0;u<options.squareSize;u++){var e=o*options.squareSize+u,n=t*options.squareSize+u,i=window.sudoku.fullMatrix[e],s=window.sudoku.fullMatrix[n];window.sudoku.fullMatrix[e]=s,window.sudoku.fullMatrix[n]=i}return window.sudoku.fullMatrix}function swapTwoLargeColumns(){transposeMatrix(),swapTwoLargeRows(),transposeMatrix()}function mixMatrix(){var t0=performance.now(),logicFunctions=["transposeMatrix()","swapTwoRows()","swapTwoRows()","swapTwoColumns()","swapTwoColumns()","swapTwoLargeRows()","swapTwoLargeColumns()"];let i=0;for(;i<options.sudokuMixIterations;){var randomFunction=Math.floor(Math.random()*logicFunctions.length);eval(logicFunctions[randomFunction]),i++}var t1=performance.now();window.sudoku.generationTime=(.001*(t1-t0)).toFixed(5)+" seconds."}function prepareEmptyMatrix(){window.sudoku.emptyMatrix=[];for(let o=0;o<options.squareSize*options.squareSize;o++){window.sudoku.emptyMatrix.push([]);for(let t=0;t<options.squareSize*options.squareSize;t++)window.sudoku.emptyMatrix[o].push("")}let o=0;for(;o<options.squareSize**4;){let t=Math.floor(Math.random()*options.squareSize**2),e=Math.floor(Math.random()*options.squareSize**2);""===window.sudoku.emptyMatrix[t][e]&&(o++,10*Math.random()>6&&(window.sudoku.emptyMatrix[t][e]=window.sudoku.fullMatrix[t][e]))}}function checkResults(o,t){let e=!1;for(let i=0;i<o.length;i++)for(let s=0;s<o.length;s++){var n=$(`.sudoku-row:eq(${i}) .sudoku-cell:eq(${s})`);o[i][s]!==t[i][s]?(e=!0,options.markWrongCellsOnFinish&&n.addClass("invalid-cell")):n.removeClass("invalid-cell")}return!e}create($(this)),window.sudoku.listenKeyPress=function(o){var t=window.event?o.keyCode:o.which;return 8==o.keyCode||46==o.keyCode||t>47&&t<58}}}(window,jQuery);